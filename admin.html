<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Admin · Platform</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
/* DESIGN SYSTEM */
:root {
  --bg: #f5f5f7;
  --bg-card: #ffffff;
  --bg-soft: #fafafa;

  --text: #111;
  --text-sub: #555;

  --border: #ddd;
  --accent: #000;

  --radius-md: 12px;
  --radius-lg: 16px;
  --radius-pill: 999px;

  --shadow-md: 0 8px 20px rgba(0,0,0,0.08);

  --space-2: 8px;
  --space-3: 12px;
  --space-4: 16px;
  --space-5: 20px;
}

/* GLOBAL */
body {
  margin:0;
  background:var(--bg);
  font-family:system-ui,-apple-system,BlinkMacSystemFont,sans-serif;
  color:var(--text);
}

/* NAVBAR */
.navbar {
  background:#fff;
  border-bottom:1px solid var(--border);
  padding:var(--space-3) var(--space-4);
  display:flex;
  align-items:center;
  gap:var(--space-3);
  position:sticky;
  top:0;
  z-index:10;
}
.navbar .title {
  font-weight:700;
  font-size:1.1rem;
}
.nav-btn {
  border-radius:var(--radius-pill);
  border:2px solid var(--accent);
  background:#fff;
  color:#000;
  padding:6px 14px;
  font-size:0.85rem;
  font-weight:600;
  cursor:pointer;
}
.nav-btn.active {
  background:#000;
  color:#fff;
}

/* LAYOUT */
.shell {
  max-width:1100px;
  margin:0 auto;
  padding:var(--space-4);
}

/* CARDS */
.card {
  background:var(--bg-card);
  border-radius:var(--radius-lg);
  padding:var(--space-4);
  border:1px solid var(--border);
  box-shadow:var(--shadow-md);
}
.card h2 {
  margin:0 0 var(--space-2);
  font-size:1rem;
}

/* GRID */
.grid {
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(260px,1fr));
  gap:var(--space-4);
}

/* FORMS */
.field {
  margin-bottom:var(--space-3);
}
.field label {
  display:block;
  font-size:0.75rem;
  margin-bottom:4px;
}
.field input,
.field textarea {
  width:100%;
  padding:var(--space-2);
  border-radius:var(--radius-md);
  border:1px solid #ccc;
  font-size:0.85rem;
}

/* BUTTONS */
.btn {
  border-radius:var(--radius-pill);
  border:2px solid var(--accent);
  background:var(--accent);
  color:#fff;
  padding:8px 14px;
  font-size:0.85rem;
  font-weight:600;
  cursor:pointer;
}
.btn.outline {
  background:#fff;
  color:#000;
}

/* LISTS */
.list {
  display:flex;
  flex-direction:column;
  gap:var(--space-2);
}
.list-item {
  background:var(--bg-soft);
  padding:var(--space-3);
  border-radius:var(--radius-md);
  display:flex;
  justify-content:space-between;
}
.pill {
  border:1px solid #000;
  padding:2px 8px;
  border-radius:var(--radius-pill);
  font-size:0.75rem;
}

/* STATUS */
.status {
  margin-top:var(--space-2);
  font-size:0.8rem;
  color:#0a7a2f;
  min-height:1em;
}
</style>
</head>

<body>

<!-- NAVBAR -->
<div class="navbar">
  <div class="title">Admin Dashboard</div>
  <button class="nav-btn active" data-section="add">Add Content</button>
  <button class="nav-btn" data-section="view">View All</button>
  <button class="nav-btn" id="logoutBtn">Sign out</button>
</div>

<div class="shell" id="content"></div>

<script type="module">
import {
  auth, db, onAuthStateChanged, signOut,
  collection, addDoc, serverTimestamp, ADMIN_EMAILS
} from "./firebase.js";
import {
  doc, setDoc, getDoc, onSnapshot, query, orderBy
} from "https://www.gstatic.com/firebasejs/10.13.1/firebase-firestore.js";

/* AUTH */
onAuthStateChanged(auth, user => {
  if (!user || !ADMIN_EMAILS.includes(user.email)) {
    window.location.href = "index";
  }
});
logoutBtn.onclick = () => signOut(auth);

/* NAVIGATION */
const content = document.getElementById("content");
const navBtns = [...document.querySelectorAll(".nav-btn[data-section]")];

function setActive(section) {
  navBtns.forEach(b => b.classList.toggle("active", b.dataset.section === section));
}
navBtns.forEach(btn => {
  btn.onclick = () => {
    setActive(btn.dataset.section);
    loadSection(btn.dataset.section);
  };
});

/* LOAD SECTIONS */
loadSection("add");

function loadSection(section) {

  /* -------------------------
     ADD CONTENT
  -------------------------- */
  if (section === "add") {
    content.innerHTML = `
      <div class="grid">

        <div class="card">
          <h2>Add Announcement</h2>
          <div class="field"><label>Title</label><input id="annTitle"></div>
          <div class="field"><label>Message</label><textarea id="annMessage" rows="3"></textarea></div>
          <button class="btn" id="annAddBtn">Add</button>
          <div class="status" id="annStatus"></div>
        </div>

        <div class="card">
          <h2>Add Rehearsal</h2>
          <div class="field"><label>Title</label><input id="schTitle"></div>
          <div class="field"><label>Date</label><input id="schDate" placeholder="2026-02-01"></div>
          <div class="field"><label>Time</label><input id="schTime" placeholder="18:00–21:00"></div>
          <button class="btn" id="schAddBtn">Add</button>
          <div class="status" id="schStatus"></div>
        </div>

        <div class="card">
          <h2>Add Track</h2>
          <div class="field"><label>Title</label><input id="trkTitle"></div>
          <div class="field"><label>URL</label><input id="trkUrl"></div>
          <button class="btn" id="trkAddBtn">Add</button>
          <div class="status" id="trkStatus"></div>
        </div>

        <div class="card">
          <h2>Add Video</h2>
          <div class="field"><label>Title</label><input id="vidTitle"></div>
          <div class="field"><label>URL</label><input id="vidUrl"></div>
          <button class="btn" id="vidAddBtn">Add</button>
          <div class="status" id="vidStatus"></div>
        </div>

        <div class="card">
          <h2>Script URL</h2>
          <div class="field"><label>URL</label><input id="scriptUrl"></div>
          <button class="btn" id="scriptSaveBtn">Save</button>
          <div class="status" id="scriptStatus"></div>
        </div>

      </div>
    `;

    /* ADD LOGIC */
    annAddBtn.onclick = async () => {
      await addDoc(collection(db,"announcements"),{
        title:annTitle.value,
        message:annMessage.value,
        createdAt:serverTimestamp()
      });
      annTitle.value = annMessage.value = "";
      annStatus.textContent = "Added!";
    };

    schAddBtn.onclick = async () => {
      await addDoc(collection(db,"schedule"),{
        title:schTitle.value,
        date:schDate.value,
        time:schTime.value,
        createdAt:serverTimestamp()
      });
      schTitle.value = schDate.value = schTime.value = "";
      schStatus.textContent = "Added!";
    };

    trkAddBtn.onclick = async () => {
      await addDoc(collection(db,"tracks"),{
        title:trkTitle.value,
        url:trkUrl.value,
        createdAt:serverTimestamp()
      });
      trkTitle.value = trkUrl.value = "";
      trkStatus.textContent = "Added!";
    };

    vidAddBtn.onclick = async () => {
      await addDoc(collection(db,"videos"),{
        title:vidTitle.value,
        url:vidUrl.value,
        createdAt:serverTimestamp()
      });
      vidTitle.value = vidUrl.value = "";
      vidStatus.textContent = "Added!";
    };

    scriptSaveBtn.onclick = async () => {
      await setDoc(doc(db,"settings","script"),{url:scriptUrl.value});
      scriptStatus.textContent = "Saved!";
    };

    return;
  }

  /* -------------------------
     VIEW EVERYTHING
  -------------------------- */
  if (section === "view") {
    content.innerHTML = `
      <h2>All Data</h2>
      <div class="grid">
        <div class="card"><h2>Announcements</h2><div id="annList" class="list"></div></div>
        <div class="card"><h2>Rehearsals</h2><div id="schList" class="list"></div></div>
        <div class="card"><h2>Tracks</h2><div id="trkList" class="list"></div></div>
        <div class="card"><h2>Videos</h2><div id="vidList" class="list"></div></div>
        <div class="card"><h2>Chat</h2><div id="chatList" class="list"></div></div>
      </div>
    `;

    onSnapshot(query(collection(db,"announcements"),orderBy("createdAt","desc")), snap=>{
      annList.innerHTML = "";
      snap.forEach(d=>{
        annList.innerHTML += `<div class="list-item"><span>${d.data().title}</span></div>`;
      });
    });

    onSnapshot(query(collection(db,"schedule"),orderBy("date","asc")), snap=>{
      schList.innerHTML = "";
      snap.forEach(d=>{
        const x=d.data();
        schList.innerHTML += `<div class="list-item"><span>${x.title}</span><span class="pill">${x.date}</span></div>`;
      });
    });

    onSnapshot(collection(db,"tracks"), snap=>{
      trkList.innerHTML = "";
      snap.forEach(d=>{
        trkList.innerHTML += `<div class="list-item"><span>${d.data().title}</span></div>`;
      });
    });

    onSnapshot(collection(db,"videos"), snap=>{
      vidList.innerHTML = "";
      snap.forEach(d=>{
        vidList.innerHTML += `<div class="list-item"><span>${d.data().title}</span></div>`;
      });
    });

    onSnapshot(query(collection(db,"chat"),orderBy("createdAt","asc")), snap=>{
      chatList.innerHTML = "";
      snap.forEach(d=>{
        const x=d.data();
        chatList.innerHTML += `<div class="list-item"><span>${x.user}: ${x.text}</span></div>`;
      });
    });

    return;
  }
}
</script>
</body>
</html>
